namespace = spreading_of_christianity

###########################################
# The Spreading of Christianity Intro Event
# 0001
###########################################
spreading_of_christianity.0001 = { # Fullscreen Intro Event
	type = character_event
	window = fullscreen_event
	title = spreading_of_christianity.0001.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { religion = religion:christianity_religion }
				desc = spreading_of_christianity.0001.desc.christian
			}
			triggered_desc = {		# Hellenism has already been mostly marginalized by Christianity
				trigger = { religion = religion:hellenism_religion }
				desc = spreading_of_christianity.0001.desc.hellenic
			}
			triggered_desc = {
				trigger = {
					OR = {			# Brythonic and Gaelic paganism are also significantly under pressure
						faith = faith:briton_pagan
						faith = faith:gael_pagan
					}
				}
				desc = spreading_of_christianity.0001.desc.briton_gaelic
			}						# Other faiths are not yet as exposed
			desc = spreading_of_christianity.0001.desc.other_non_christian
		}
	}
	theme = realm
	override_background = { 
		reference = holy_site_christian
	}
	override_sound = { reference = "event:/DLC/FP2/SFX/UI/fp2_struggle_ui_intro_animate" }

	widgets = {
		widget = {
 			gui = "event_window_widget_situation_info_spreading_of_christianity"
 			container = "dynamic_content_widget"
 			controller = situation_info
 			setup_scope = { situation:spreading_of_christianity_situation = { save_scope_as = situation } }
		}
	}
	
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { religion = religion:christianity_religion }
						desc = spreading_of_christianity.0001.a.christian
					}
					triggered_desc = {
						trigger = { religion = religion:hellenism_religion }
						desc = spreading_of_christianity.0001.a.hellenic
					}
					triggered_desc = {
						trigger = {
							OR = {
								faith = faith:briton_pagan
								faith = faith:gael_pagan
							}
						}
						desc = spreading_of_christianity.0001.a.briton_gaelic
					}
					desc = spreading_of_christianity.0001.a.other_non_christian
				}
			}
		}
		clicksound = "event:/DLC/FP2/SFX/UI/fp2_struggle_start_select"
	}
}


# Toast for flipped provinces
spreading_of_christianity.0010 = {
	scope = none
	hidden = yes

	immediate = {
		scope:current_county.holder = {
			add_to_list = informees
			every_liege_or_above = {
				add_to_list = informees
			}
		}
		every_in_list = {
			list = informees
			switch = {
				trigger = faith
				scope:current_county.faith = { # Good if same as new faith
					send_interface_message = {
						type = msg_council_conversion_good
						title = spreading_of_christianity.0010.t
						desc = spreading_of_christianity.0010.desc
						right_icon = scope:current_county
					}
				}
				scope:old_faith = {
					send_interface_message = { # Bad if same faith as county
						type = msg_council_conversion_bad
						title = spreading_of_christianity.0010.t
						desc = spreading_of_christianity.0010.desc
						right_icon = scope:current_county
					}
				}
				fallback = {
					send_interface_message = { # Neutral otherwise
						type = msg_council_conversion_neutral
						title = spreading_of_christianity.0010.t
						desc = spreading_of_christianity.0010.desc
						right_icon = scope:current_county
					}
				}
			}
		}
	}
}

# Subregion phase changes
spreading_of_christianity.0020 = { 
	type = character_event
	title = spreading_of_christianity.0020.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_0 }
				}
				desc = spreading_of_christianity.0020.desc.phase_0.decreased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_0 }
				}
				desc = spreading_of_christianity.0020.desc.phase_0.decreased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_1 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_1.increased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_1 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_1.increased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_1 }
					global_var:soc_current_phase_change = flag:decreased
				}
				desc = spreading_of_christianity.0020.desc.phase_1.decreased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_1 }
					global_var:soc_current_phase_change = flag:decreased
				}
				desc = spreading_of_christianity.0020.desc.phase_1.decreased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_2 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_2.increased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_2 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_2.increased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_2 }
					global_var:soc_current_phase_change = flag:decreased
				}
				desc = spreading_of_christianity.0020.desc.phase_2.decreased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_2 }
					global_var:soc_current_phase_change = flag:decreased
				}
				desc = spreading_of_christianity.0020.desc.phase_2.decreased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_3 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_3.increased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_3 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_3.increased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_3 }
					global_var:soc_current_phase_change = flag:decreased
				}
				desc = spreading_of_christianity.0020.desc.phase_3.decreased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_3 }
					global_var:soc_current_phase_change = flag:decreased
				}
				desc = spreading_of_christianity.0020.desc.phase_3.decreased.non_christian
			}
			triggered_desc = {
				trigger = { 
					religion = religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_4 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_4.increased.christian
			}
			triggered_desc = {
				trigger = { 
					religion != religion:christianity_religion
					scope:current_sub_region = { sub_region_current_phase = spreading_of_christianity_phase_4 }
					global_var:soc_current_phase_change = flag:increased
				}
				desc = spreading_of_christianity.0020.desc.phase_4.increased.non_christian
			}
		}
	}
	
	theme = realm
	override_background = { 		# TODO
		reference = holy_site_christian
	}
	
	immediate = {
		situation:spreading_of_christianity_situation = { save_scope_as = situation }
		if = {
			limit = { global_var:soc_current_phase_change = flag:increased }
			custom_tooltip = spreading_of_christianity.0020.tt_phase_increased
		}
		else_if = {
			limit = { global_var:soc_current_phase_change = flag:decreased }
			custom_tooltip = spreading_of_christianity.0020.tt_phase_decreased
		}
	}
	
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { 
							religion = religion:christianity_religion
							global_var:soc_current_phase_change = flag:increased
						}
						desc = spreading_of_christianity.0020.a.increased.christian
					}
					triggered_desc = {
						trigger = { 
							religion != religion:christianity_religion
							global_var:soc_current_phase_change = flag:increased
						}
						desc = spreading_of_christianity.0020.a.increased.non_christian
					}
					triggered_desc = {
						trigger = { 
							religion = religion:christianity_religion
							global_var:soc_current_phase_change = flag:decreased
						}
						desc = spreading_of_christianity.0020.a.decreased.christian
					}
					triggered_desc = {
						trigger = { 
							religion != religion:christianity_religion
							global_var:soc_current_phase_change = flag:decreased
						}
						desc = spreading_of_christianity.0020.a.decreased.non_christian
					}
				}
			}
		}
	}
}

###########################################
# Flavour/Spread Events
# 0100 - 0199
###########################################

# First Anglo-Saxon Christian King
spreading_of_christianity.0100 = {
	type = character_event
	content_source = dlc_BTWK
	hidden = yes
	
	trigger = {
		culture = { has_cultural_pillar = heritage_west_germanic }
		highest_held_title_tier >= tier_kingdom
		primary_title.title_capital_county = { geographical_region = btwk_world_britannia }
		is_independent_ruler = yes
		religion = religion:christianity_religion
		NOT = { has_global_variable = first_saxon_catholic_king }
	}
	
	immediate = {
		save_scope_as = target_char
		trigger_event = { id = spreading_of_christianity.0101 }
		every_player = {
			limit = { NOT = { this = PREV } }
			trigger_event = { id = spreading_of_christianity.0101 }
		}
		set_global_variable = first_saxon_catholic_king
		# Update situation variables since this event speeds up spread in Anglo-Saxon counties
		BTWK_soc_situation_update_proselytization_modifiers_effect = yes
	}
}

spreading_of_christianity.0101 = {
	type = character_event
	content_source = dlc_BTWK
	title = spreading_of_christianity.0101.t
	desc = spreading_of_christianity.0101.desc
	theme = faith
	override_background = { 
		reference = temple_church
	}
	
	left_portrait = {
		character = scope:target_char
		animation = prayer
	}
	
	immediate = {
		if = {
			limit = { this = scope:target_char }
			add_piety = 100
		}
		custom_tooltip = spreading_of_christianity.0101.tt
	}

	option = {
		name = {
			trigger = {
				religion = religion:christianity_religion
				culture = { has_cultural_pillar = heritage_west_germanic }
			}
			text = spreading_of_christianity.0101.a.anglosaxon.christian
		}
		name = {
			trigger = {
				religion != religion:christianity_religion
				culture = { has_cultural_pillar = heritage_west_germanic }
			}
			text = spreading_of_christianity.0101.a.anglosaxon.non_christian
		}
		name = {
			trigger = {
				religion = religion:christianity_religion
				OR = {
					culture = { has_cultural_pillar = heritage_brythonic }
					AND = {
						culture = { has_cultural_pillar = heritage_latin }
						capital_province = { geographical_region = btwk_world_britannia }
					}
				}
			}
			text = spreading_of_christianity.0101.a.briton.christian
		}
		name = {
			trigger = {
				religion != religion:christianity_religion
				OR = {
					culture = { has_cultural_pillar = heritage_brythonic }
					AND = {
						culture = { has_cultural_pillar = heritage_latin }
						capital_province = { geographical_region = btwk_world_britannia }
					}
				}
			}
			text = spreading_of_christianity.0101.a.briton.non_christian
		}
		name = {
			trigger = {
				religion = religion:christianity_religion
				NOR = {
					culture = { has_cultural_pillar = heritage_west_germanic }
					culture = { has_cultural_pillar = heritage_brythonic }
					AND = {
						culture = { has_cultural_pillar = heritage_latin }
						capital_province = { geographical_region = btwk_world_britannia }
					}
				}
			}
			text = spreading_of_christianity.0101.a.other.christian
		}
		name = {
			trigger = {
				religion != religion:christianity_religion
				NOR = {
					culture = { has_cultural_pillar = heritage_west_germanic }
					culture = { has_cultural_pillar = heritage_brythonic }
					AND = {
						culture = { has_cultural_pillar = heritage_latin }
						capital_province = { geographical_region = btwk_world_britannia }
					}
				}
			}
			text = spreading_of_christianity.0101.a.other.non_christian
		}
	}
}

# TODO AI event for deciding on missionaries, on yearly pulse
# Should be mostly based on AI personalities + income
# To remove modifier, check if value < -10 (so it doesn't oscillate too much)

# - Promote Internal Missionaries:
#	- Requires >= 1 unreformed pagan province in subrealm
#	- Requires ai_zeal > 0
#	value = -25
#		+ ai_zeal 
# 		- ai_greed * 0.5 if ai_greed > 0
#		+ (monthly_character_balance / monthly_character_income - 0.3) * 25 / .15 with max of 25
#		+ 50 * share of unreformed pagan provinces in subrealm

# - Promote External Missionaries:
#	- Precalculate list of in-range provinces for each ruler first (same calculation as for calculating the spread)
#	- Requires ai_zeal > 25
#	value = -50
#		+ ai_zeal 
# 		- ai_greed * 0.5 if ai_greed > 0
#		+ (monthly_character_balance / monthly_character_income - 0.3) * 30 / .15 with max of 25
#		+ 50 * share of unreformed pagan provinces in range

# - Ban Missionaries
#	- Requires >= 1 province in with positive spread in subrealm
#	- Requires ai_zeal > 25
#	value = -25
#		+ ai_zeal
#		- ai_rationality * 0.5
#		+ (monthly_character_balance / monthly_character_income - 0.1) * 100, capped within 50 to -25

# - Encourage Missionaries
#	- Requires >= 1 province in with positive spread in subrealm
#	- Never if ai_zeal > 25
#	value = -25
#		- ai_zeal
#		+ ai_rationality * 0.5
#		- monthly_character_balance / monthly_character_income * 200, capped within 50 to -25