#########################################################################
# Anglo-Saxon Title Decisions											#
#########################################################################

create_anglo_saxon_de_jure_duchies_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 12
		duchy = 12
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = create_anglo_saxon_de_jure_duchies_decision_desc

	is_shown = {
		can_create_germanic_title_culture_trigger = yes
		any_in_global_list = {
			variable = anglo_saxon_duchy_list
			NOT = { has_variable = title_created_de_jure }
		}
	}

	is_valid_showing_failures_only = {
		can_create_germanic_title_trigger = yes
		trigger_if = {
			limit = { is_independent_ruler = no }
			liege = { highest_held_title_tier > tier_duchy }
		}
		custom_tooltip = {
			text = create_anglo_saxon_de_jure_duchies_decision_any_formable_tt
			any_in_global_list = {
				variable = anglo_saxon_duchy_list
				NOT = { has_variable = title_created_de_jure }
				ROOT = { can_create_formable_title = { TITLE = PREV } }
			}
		}
	}

	effect = {
		# This part is purely for display purposes
		if = {
			limit = {
				is_ai = no
				has_variable = selected_title
			}
			this.var:selected_title = {
				save_scope_as = title_created_de_jure_pretend
				every_in_list = {
					variable = de_jure_affected_territory
					show_as_tooltip = {
						check_de_jure_liege_effect = yes
					}
				}
			}
			every_in_global_list = {
				variable = celtic_duchy_list
				if = {
					limit = {
						is_capital_in_anglo_saxon_duchy_trigger = { DUCHY = scope:title_created_de_jure_pretend }
					}
					if = {
						limit = { exists = holder }
						show_as_tooltip = {
							# destroy_title must be in character scope to work
							holder = { destroy_title = prev }
						}
					}
				}
			}
			show_as_tooltip = {
				get_title = this.var:selected_title
			}
		}
		hidden_effect = {
			every_in_global_list = {
				variable = anglo_saxon_duchy_list
				limit = { 
					ROOT = { can_create_formable_title = { TITLE = PREV } }
					NOT = { has_variable = title_created_de_jure }
				}
				ROOT = { create_anglo_saxon_duchy_effect = { TITLE = PREV } }
			}
			remove_variable = selected_title
		}
	}
	
	ai_potential = {
		is_independent_ruler = yes
	}

	ai_will_do = {
		base = 100
	}
	
	widget = {
		gui = "decision_view_widget_create_anglo_saxon_de_jure_duchies"
		controller = decision_option_list_controller

		### This placeholder has to be here or the game will crash
		item = {
			value = none
			is_shown = { always = yes }
			is_valid = { always = yes }
			localization = placeholder_name
		}
	}
}

destroy_anglo_saxon_de_jure_duchies_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 12
		duchy = 12
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = destroy_anglo_saxon_de_jure_duchies_decision_desc

	is_shown = {
		can_create_germanic_title_culture_trigger = no
		any_in_global_list = {
			variable = anglo_saxon_duchy_list
			has_variable = title_created_de_jure
		}
	}

	is_valid_showing_failures_only = {
		NOT = { top_liege_can_create_germanic_title_culture_trigger = yes }
		custom_tooltip = {
			text = destroy_anglo_saxon_de_jure_duchies_decision_any_destroyable_tt
			any_in_global_list = {
				variable = anglo_saxon_duchy_list
				has_variable = title_created_de_jure
				ROOT = {
					can_destroy_formable_title = { 
						TITLE = PREV
						COUNTY_TRIGGER = "NOT = { germanic_controlled_trigger = yes }" 
					}
				}
			}
		}
	}

	effect = {
		# This part is purely for display purposes
		if = {
			limit = {
				is_ai = no
				has_variable = selected_title
			}
			this.var:selected_title = {
				save_scope_as = title_created_de_jure_ignore
				every_in_list = {
					variable = de_jure_affected_territory
					show_as_tooltip = {
						check_de_jure_liege_effect = yes
					}
				}
				if = {
					limit = { exists = holder }
					show_as_tooltip = {
						destroy_title = this
					}
				}
			}
		}
		hidden_effect = {
			every_in_global_list = {
				variable = anglo_saxon_duchy_list
				limit = { 
					ROOT = { 
						can_destroy_formable_title = { 
							TITLE = PREV
							COUNTY_TRIGGER = "NOT = { germanic_controlled_trigger = yes }" 
						} 
					}
					has_variable = title_created_de_jure
				}
				ROOT = { destroy_anglo_saxon_duchy_effect = { TITLE = PREV } }
			}
			remove_variable = selected_title
		}
	}
	
	ai_potential = {
		is_independent_ruler = yes
	}

	ai_will_do = {
		base = 100
	}
	
	widget = {
		gui = "decision_view_widget_destroy_anglo_saxon_de_jure_duchies"
		controller = decision_option_list_controller

		### This placeholder has to be here or the game will crash
		item = {
			value = none
			is_shown = { always = yes }
			is_valid = { always = yes }
			localization = placeholder_name
		}
	}
}

integrate_duchy_anglo_saxon_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = integrate_duchy_anglo_saxon_decision_desc

	is_shown = {
		can_create_germanic_title_culture_trigger = yes
		any_held_title = {
			is_anglo_saxon_kingdom_trigger = yes
			has_variable_list = integratable_duchies
			save_temporary_scope_as = current_kingdom
			any_in_list = {
				variable = integratable_duchies
				ROOT = {
					potential_integrate_duchy_anglo_saxon_trigger = {
						DUCHY = prev
						NEW_LIEGE = scope:current_kingdom
					}
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		can_create_germanic_title_trigger = yes
		government_is_not_tribal_trigger = yes
		can_integrate_duchy_anglo_saxon_cost_trigger = yes
		custom_tooltip = {
			text = integrate_duchy_anglo_saxon_any_integratable_tt
			any_held_title = {
				is_anglo_saxon_kingdom_trigger = yes
				has_variable_list = integratable_duchies
				save_temporary_scope_as = current_kingdom
				any_in_list = {
					variable = integratable_duchies
					ROOT = {
						potential_integrate_duchy_anglo_saxon_trigger = {
							DUCHY = prev
							NEW_LIEGE = scope:current_kingdom
						}
						can_integrate_duchy_anglo_saxon_trigger = {
							DUCHY = prev
							NEW_LIEGE = scope:current_kingdom
						}
					}
				}
			}
		}
	}

	effect = {
		# This part is purely for display purposes
		if = {
			limit = {
				is_ai = no
				has_variable = selected_title
			}
			this.var:selected_title.var:duchy = { save_scope_as = integrated_kingdom_pretend }
			this.var:selected_title.var:new_liege = { save_scope_as = integrated_kingdom_pretend_value }
			show_as_tooltip = {
				this.var:selected_title.var:duchy = {
					check_de_jure_liege_effect = yes
				}
			}
			integrate_duchy_anglo_saxon_cost_effect = yes
		}
		hidden_effect = {
			generate_integrate_duchy_anglo_saxon_list = yes
			while = {
				limit = {
					any_in_list = {
						variable = integrate_duchy_anglo_saxon_list
						ROOT = {
							can_integrate_duchy_anglo_saxon_cost_trigger = yes
							potential_integrate_duchy_anglo_saxon_trigger = {
								DUCHY = prev.var:duchy
								NEW_LIEGE = prev.var:new_liege
							}
							can_integrate_duchy_anglo_saxon_trigger = {
								DUCHY = prev.var:duchy
								NEW_LIEGE = prev.var:new_liege
							}
						}
					}
				}
				set_variable = in_while
				random_in_list = {
					variable = integrate_duchy_anglo_saxon_list
					limit = {
						ROOT = {
							can_integrate_duchy_anglo_saxon_cost_trigger = yes
							potential_integrate_duchy_anglo_saxon_trigger = {
								DUCHY = prev.var:duchy
								NEW_LIEGE = prev.var:new_liege
							}
							can_integrate_duchy_anglo_saxon_trigger = {
								DUCHY = prev.var:duchy
								NEW_LIEGE = prev.var:new_liege
							}
						}
					}
					ROOT = {
						integrate_duchy_anglo_saxon_cost_effect = yes
						integrate_duchy_anglo_saxon_effect = {
							DUCHY = prev.var:duchy
							NEW_DE_JURE_LIEGE = prev.var:new_liege
						}
					}
					generate_integrate_duchy_anglo_saxon_list = yes
				}
			}
			remove_variable = selected_title
		}
	}
	
	ai_potential = {
		is_independent_ruler = yes
	}

	ai_will_do = {
		base = 100
	}
	
	widget = {
		gui = "decision_view_widget_integrate_duchy_anglo_saxon"
		controller = decision_option_list_controller

		### This placeholder has to be here or the game will crash
		item = {
			value = none
			is_shown = { always = yes }
			is_valid = { always = yes }
			localization = placeholder_name
		}
	}
}

mercia_annex_north_bank_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = mercia_annex_north_bank_decision_desc

	is_shown = {
		has_title = title:k_mercia
		NOT = { title:k_mercia = { has_variable = annexed_north_bank } }
	}

	is_valid = {
		is_independent_ruler = yes
		government_is_not_tribal_trigger = yes
		prestige_level >= medium_prestige_level
		completely_controls = title:c_dorchester
		completely_controls = title:c_alchester
		completely_controls = title:c_lechlade
		completely_controls = title:c_wychwood
		NOT = { has_title = title:d_berkshire.de_jure_liege }
	}

	effect = {
		add_prestige = 100
		add_legitimacy = 25
		if = {
			limit = {
				NOR = {
					title:d_cilternsaete = { has_variable = title_created_de_jure }
					title:d_south_angles = { has_variable = title_created_de_jure }
					title:d_hwicce = { has_variable = title_created_de_jure }
				}
			}
			custom_tooltip = {
				text = mercia_annex_north_bank_decision_effect_tt2
			}
		}
		else = {
			if = {
				limit = {
					title:d_cilternsaete = { has_variable = title_created_de_jure }
				}
				show_as_tooltip = {
					title:d_cilternsaete = { 
						save_scope_as = title_expanded_de_jure_pretend
						every_in_list = {
							variable = de_jure_affected_territory
							show_as_tooltip = {
								check_de_jure_liege_effect = yes
							}
						}
					}
				}
			}
			if = {
				limit = {
					title:d_south_angles = { has_variable = title_created_de_jure }
				}
				show_as_tooltip = {
					title:d_south_angles = { 
						save_scope_as = title_expanded_de_jure_pretend
						every_in_list = {
							variable = de_jure_affected_territory
							show_as_tooltip = {
								check_de_jure_liege_effect = yes
							}
						}
					}
				}
			}
			if = {
				limit = {
					title:d_hwicce = { has_variable = title_created_de_jure }
				}
				show_as_tooltip = {
					title:d_hwicce = { 
						save_scope_as = title_expanded_de_jure_pretend
						every_in_list = {
							variable = de_jure_affected_territory
							show_as_tooltip = {
								check_de_jure_liege_effect = yes
							}
						}
					}
				}
			}
			if = {
				limit = {
					OR = {
						NOT = { title:d_cilternsaete = { has_variable = title_created_de_jure } }
						NOT = { title:d_south_angles = { has_variable = title_created_de_jure } }
						NOT = { title:d_hwicce = { has_variable = title_created_de_jure } }
					}
				}
				title:d_hwicce = { 		# Hack to make this show up at the bottom
					custom_tooltip = {
						text = mercia_annex_north_bank_decision_effect_tt
					}
				}
			}
		}
		trigger_event = { id = titular_titles_anglosaxon.0004 }
	}
	
	cost = {
		gold = { value = 100 }
		piety = { value = 75 }
	}
	
	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

create_berkshire_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 0
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = create_berkshire_decision_desc

	is_shown = {
		OR = {
			has_title = title:d_berkshire.de_jure_liege
			has_title = title:k_mercia
		}
		title:k_mercia = {
			has_variable = annexed_north_bank
		}
		title:d_berkshire = {
			NOT = { has_variable = title_expanded_de_jure }
		}
	}

	is_valid = {
		is_independent_ruler = yes
		government_is_not_tribal_trigger = yes
		prestige_level >= medium_prestige_level
		custom_description = {
			text = current_duchy_is_created_de_jure_trigger
			object = title:d_berkshire
			title:d_berkshire = { has_variable = title_created_de_jure }
		}
		completely_controls = title:c_vedonium
		OR = {
			completely_controls = title:c_abingdon
			completely_controls = title:c_wantage
		}
		completely_controls = title:c_reading
		completely_controls = title:c_alaunodunum
	}

	effect = {
		show_as_tooltip = {
			title:d_berkshire = {
				set_title_name_w_tooltip_effect = { NEW_NAME = BERKSHIRE }
				set_variable = custom_name
				save_scope_as = title_expanded_de_jure_pretend
				every_in_list = {
					variable = de_jure_affected_territory
					check_de_jure_liege_effect = yes
				}
			}
			title:d_wiltshire = { 
				save_scope_as = title_expanded_de_jure_pretend
				every_in_list = {
					variable = de_jure_affected_territory
					check_de_jure_liege_effect = yes
				}
			}
			title:d_winchestershire = { 
				save_scope_as = title_expanded_de_jure_pretend
				every_in_list = {
					variable = de_jure_affected_territory
					check_de_jure_liege_effect = yes
				}
			}
		}
		if = {
			limit = { has_title = title:k_mercia }
			custom_tooltip = {
				text = create_berkshire_decision_integration_allowed_effect_tt
			}
		}
		trigger_event = { id = titular_titles_anglosaxon.0006 }
	}
	
	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

expand_surrey_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major

	ai_check_interval_by_tier = {
		barony = 0
		county = 0
		duchy = 12
		kingdom = 12
		empire = 12
		hegemony = 12
	}

	desc = expand_surrey_decision_desc

	is_shown = {
		OR = {
			AND = {
				has_title = title:d_surrey.de_jure_liege
				NOT = { title:d_surrey.de_jure_liege = title:d_westcantware.de_jure_liege }
			}
			AND = {
				has_title = title:d_surrey
				NOT = { highest_held_title_tier > tier_duchy }
			}
		}
		title:d_surrey = {
			NOT = { has_variable = title_expanded_de_jure }
		}
	}

	is_valid = {
		is_independent_ruler = yes
		government_is_not_tribal_trigger = yes
		prestige_level >= medium_prestige_level
		custom_description = {
			text = current_duchy_is_created_de_jure_trigger
			object = title:d_surrey
			title:d_surrey = { has_variable = title_created_de_jure }
		}
		completely_controls = title:c_noviomagus_cantiacorum
		completely_controls = title:c_kingston
		trigger_if = {
			limit = {
				AND = {
					has_title = title:d_surrey
					NOT = { highest_held_title_tier > tier_duchy }
				}
			}
			NOT = { has_title = title:d_westcantware }
		}
		trigger_if = {
			limit = {
				AND = {
					has_title = title:d_surrey.de_jure_liege
					NOT = { title:d_surrey.de_jure_liege = title:d_westcantware.de_jure_liege }
				}
			}
			NOT = { has_title = title:d_westcantware.de_jure_liege }
		}
	}

	effect = {
		add_prestige = 75
		add_legitimacy = 20
		show_as_tooltip = {
			title:d_surrey = {
				save_scope_as = title_expanded_de_jure_pretend
				every_in_list = {
					variable = de_jure_affected_territory
					check_de_jure_liege_effect = yes
				}
			}
		}
		trigger_event = { id = titular_titles_anglosaxon.0008 }
	}
	
	cost = {
		gold = { value = 75 }
		piety = { value = 50 }
	}
	
	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

# TODO

# form_northumbria_decision

# create_hampshire_decision (maybe)