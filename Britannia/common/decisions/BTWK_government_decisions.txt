#########################################################################
# Government Decisions													#
#########################################################################

# Convert from Pre-Feudal to Feudalism
convert_pre_feudal_to_feudalism_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	desc = convert_pre_feudal_to_feudalism_decision_desc

	ai_check_interval_by_tier = {
		barony = 0
		county = 72
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 36
	}

	is_shown = {
		government_has_flag = government_is_pre_feudal
		OR = {
			top_liege = this
			AND = {
				top_liege != this
				liege = {
					NOR = {
						government_has_flag = government_is_feudal
						government_has_flag = government_is_clan
						government_has_flag = government_is_administrative
					}
				}
			}
		}
	}

	is_valid = {
		OR = {
			has_realm_law = crown_authority_1
			has_realm_law = crown_authority_2
			has_realm_law = crown_authority_3
		}
		custom_description = {
			text = faith_is_reformed
			subject = root
			faith = { NOT = { has_doctrine_parameter = unreformed } }
		}
		prestige_level >= 2
		capital_province.county = {
			development_level >= 15
		}
		custom_description = {
			text = capital_has_building_requirements_for_feudal
			capital_province = {
				has_building = castle_02
				combined_building_level >= 15
			}
		}
		BTWK_reform_from_pre_feudal_innovations_trigger = yes
		trigger_if = {
			limit = { is_ai = no }
			custom_description = {
				text = has_tribal_obligations_condition_for_feudal
				percent_count_or_higher_vassals_with_tribal_obligations <= 0.33
			}
		}
	}

	cost = {
		prestige = 200
		gold = 100
	}

	effect = {
		trigger_event = BTWK_government.0001
		change_government = feudal_government
		custom_tooltip = easier_for_vassals_to_convert_to_feudal
		hidden_effect = {
			save_scope_as = actor
			every_vassal = {
				trigger_event = {
					id = BTWK_government.0002
					days = 3
				}
			}
		}
	}

	ai_will_do = {
		base = 100
		modifier = {		# Shouldn't go for feudal if prefers Sub-Roman
			add = -100
			is_romanized_government_culture_trigger = yes
			OR = {
				AND = {
					realm_size >= 25
					primary_title.tier >= tier_kingdom
				}
				any_neighboring_and_across_water_top_liege_realm_owner = {
					government_has_flag = government_is_administrative
				}				
			}
		}
	}
}

convert_pre_feudal_to_feudalism_through_liege_decision = {
	picture = {
		trigger = {
			has_tgp_dlc_trigger = yes
			liege = {
				culture = { has_cultural_pillar = heritage_japonic }
			}
		}
		reference = "gfx/interface/illustrations/decisions/tgp_dominance.dds"
	}
	picture = {
		trigger = {
			liege = {
				government_has_flag = government_is_clan
			}
		}
		reference = "gfx/interface/illustrations/event_scenes/bp1_courtyard_mena.dds"
	}
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_realm.dds"
	}
	decision_group_type = major
	desc = convert_pre_feudal_to_feudalism_through_liege_decision_desc

	ai_check_interval_by_tier = {
		barony = 0
		county = 72
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 36
	}

	is_shown = {
		government_has_flag = government_is_pre_feudal
		liege = {
			has_government = feudal_government
		}
	}

	is_valid = {
		OR = {
			has_realm_law = crown_authority_1
			has_realm_law = crown_authority_2
			has_realm_law = crown_authority_3
		}
		custom_description = {
			text = faith_is_reformed
			subject = root
			faith = { NOT = { has_doctrine_parameter = unreformed } }
		}
		capital_province.county = {
			development_level >= 10
		}
		custom_description = {
			text = capital_has_building_requirements_for_feudal_through_liege
			capital_province = {
				combined_building_level >= 10
			}
		}
	}

	cost = {
		prestige = 150
		gold = 75
	}

	effect = {
		trigger_event = BTWK_government.0001
		change_government = feudal_government
		custom_tooltip = easier_for_vassals_to_convert_to_feudal
		hidden_effect = {
			save_scope_as = actor
			every_vassal = {
				trigger_event = {
					id = BTWK_government.0002
					days = 3
				}
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

convert_sub_roman_to_germanic_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/ep3_cerimonial_decision.dds"
	}
	decision_group_type = major
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					top_liege != this
				}
				desc = convert_sub_roman_to_germanic_decision_from_liege_desc
			}
			desc = convert_sub_roman_to_germanic_decision_desc
		}
	}

	ai_check_interval_by_tier = {
		barony = 0
		county = 72
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 36
	}

	is_shown = {
		government_has_flag = government_is_sub_roman
		OR = {
			AND = {
				top_liege != this
				liege = {
					government_has_flag = government_is_germanic
				}
			}
			AND = {
				top_liege = this
				BTWK_should_become_germanic_government_trigger = yes
			}
		}
	}

	is_valid = {
		trigger_if = {
			limit = { top_liege = this }
			trigger_if = {
				limit = { BTWK_admin_gov_enabled_trigger = yes }
				OR = {
					has_realm_law = imperial_bureaucracy_1
					has_realm_law = imperial_bureaucracy_2
					has_realm_law = imperial_bureaucracy_3
				}
			}
			trigger_else = {
				OR = {
					has_realm_law = crown_authority_1
					has_realm_law = crown_authority_2
					has_realm_law = crown_authority_3
				}
			}
			primary_title = { title_held_years >= 10 }
		}
		trigger_else = {
			custom_description = {
				text = similar_culture_as_liege
				OR = {
					culture = liege.culture
					culture = {
						cultural_acceptance = { target = root.liege.culture value >= 60 }
					}
				}
			}
		}
	}

	cost = {
		prestige = 150
		gold = {
			value = 0
			if = {
				limit = {
					top_liege = this
				}
				add = 50
			}
		}
	}

	effect = {
		trigger_event = BTWK_government.0003
		save_scope_as = actor

		if = {
			limit = { BTWK_admin_gov_enabled_trigger = yes }
			tgp_domicile_conversion_when_changing_government_type = {
				NEW_DOMICILE_TYPE = estate
				NEW_GOVERNMENT_TYPE = germanic_government
			}
			change_government = germanic_government
		}
		else = {
			change_government = germanic_no_dlc_government
		}
		custom_tooltip = sub_roman_vassals_will_convert

		hidden_effect = {
			every_vassal_or_below = {
				limit = { government_has_flag = government_is_sub_roman }
				if = {
					limit = { BTWK_admin_gov_enabled_trigger = yes }
					tgp_domicile_conversion_when_changing_government_type = {
						NEW_DOMICILE_TYPE = estate
						NEW_GOVERNMENT_TYPE = germanic_government
					}
					change_government = germanic_government
				}
				else = {
					change_government = germanic_no_dlc_government
				}
				trigger_event = {
					id = BTWK_government.0004
					days = 3
				}
			}
		}
	}

	ai_potential = {
		prestige >= 150
	}

	ai_will_do = {
		base = 0

		modifier = {
			add = 100
			top_liege = this
		}
		modifier = {
			add = 100
			top_liege != this
			opinion = {
				target = liege
				value >= 0
			}
		}
	}
}

convert_germanic_to_sub_roman_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/ep3_cerimonial_decision.dds"
	}
	decision_group_type = major
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					top_liege != this
				}
				desc = convert_sub_roman_to_germanic_decision_from_liege_desc
			}
			desc = convert_sub_roman_to_germanic_decision_desc
		}
	}

	ai_check_interval_by_tier = {
		barony = 0
		county = 72
		duchy = 36
		kingdom = 36
		empire = 36
		hegemony = 36
	}

	is_shown = {
		government_has_flag = government_is_germanic
		OR = {
			AND = {
				top_liege != this
				liege = {
					government_has_flag = government_is_sub_roman
				}
			}
			AND = {
				top_liege = this
				BTWK_should_become_sub_roman_government_trigger = yes
			}
		}
	}

	is_valid = {
		trigger_if = {
			limit = { top_liege = this }
			trigger_if = {
				limit = { BTWK_admin_gov_enabled_trigger = yes }
				OR = {
					has_realm_law = imperial_bureaucracy_1
					has_realm_law = imperial_bureaucracy_2
					has_realm_law = imperial_bureaucracy_3
				}
			}
			trigger_else = {
				OR = {
					has_realm_law = crown_authority_1
					has_realm_law = crown_authority_2
					has_realm_law = crown_authority_3
				}
			}
			primary_title = { title_held_years >= 10 }
		}
		trigger_else = {
			custom_description = {
				text = similar_culture_as_liege
				OR = {
					culture = liege.culture
					culture = {
						cultural_acceptance = { target = root.liege.culture value >= 60 }
					}
				}
			}
		}
	}

	cost = {
		prestige = 150
		gold = {
			value = 0
			if = {
				limit = {
					top_liege = this
				}
				add = 50
			}
		}
	}

	effect = {
		trigger_event = BTWK_government.0005
		save_scope_as = actor

		if = {
			limit = { BTWK_admin_gov_enabled_trigger = yes }
			tgp_domicile_conversion_when_changing_government_type = {
				NEW_DOMICILE_TYPE = estate
				NEW_GOVERNMENT_TYPE = sub_roman_government
			}
			change_government = sub_roman_government
		}
		else = {
			change_government = sub_roman_no_dlc_government
		}
		custom_tooltip = germanic_vassals_will_convert

		hidden_effect = {
			every_vassal_or_below = {
				limit = { government_has_flag = government_is_germanic }
				if = {
					limit = { BTWK_admin_gov_enabled_trigger = yes }
					tgp_domicile_conversion_when_changing_government_type = {
						NEW_DOMICILE_TYPE = estate
						NEW_GOVERNMENT_TYPE = sub_roman_government
					}
					change_government = sub_roman_government
				}
				else = {
					change_government = sub_roman_no_dlc_government
				}
				trigger_event = {
					id = BTWK_government.0006
					days = 3
				}
			}
		}
	}

	ai_potential = {
		prestige >= 150
	}

	ai_will_do = {
		base = 0

		modifier = {
			add = 100
			top_liege = this
		}
		modifier = {
			add = 100
			top_liege != this
			opinion = {
				target = liege
				value >= 0
			}
		}
	}
}