# Called from code after history generation
# Empty scope
on_game_start = {
	on_actions = { BTWK_de_jure_setup }
	effect = {
		# Mark some faiths to block conversion till specific decisions are taken.
		# TODO Block all Muslim faiths until it appears
		# religion:islam_religion = {
			# set_variable = { name = block_conversion_till_decision_taken }
		# }
	}
}

# Like on_game_start, except it is called once the host (or player, in single player) exits the lobby. Good for anything where you need to know who the players are, or what the game rules are
on_game_start_after_lobby = {
	effect = {		
		# TODO Set starting cultural acceptance		
	}
}

BTWK_de_jure_setup = {
	effect = {
		### DEFAULT SETUP ###
		every_county = {
			set_variable = {
				name = default_duchy
				value = this.duchy
			}
		}
		
		### ANGLO-SAXON TITLE SETUP ###
		
		## KENT
		title:d_cantware = {
			title:c_durovernum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_thanet = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_portus_dubris = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_portus_lemanis = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_durolevum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_westcantware = {
			title:c_aylesford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_crayford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_noviomagus_cantiacorum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_kingston = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_the_downs = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_surrey = {
			title:c_crondall = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_alaunodunum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_woking = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_godalming = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		
		## ESSEX
		title:d_eastseaxe = {
			title:c_camulodunum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_stour = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_tendring = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_dengie = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_thunreslea = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_dunmow = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_uttlesford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_middleseaxe = {
			title:c_londinium = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_brinavis = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_east_lea = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_west_lea = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_verulanium = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_hertford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_ash = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_chesham = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		
		## SUSSEX
		title:d_the_weald = {
			title:c_regentium = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_arundel = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_novus_portus = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_anderitum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_hastings = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_anderida = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_portus_adurni = { set_variable = { name = secondary_anglo_saxon_duchy value = PREV } }
		}
		
		## WESSEX
		title:d_hampshire = {
			title:c_clausentum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_lemanus = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_vectis = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_portus_adurni = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_berkshire = {
			title:c_venta = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_vindomis = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_calleva = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_andover = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_reading = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_spinae = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_vedonium = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_wantage = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_cilternsaete = {
			title:c_aylesbury = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_alchester = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_chiltern_hills = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_bensington = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_wiltshire = {
			title:c_sorviodunum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_ambra = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_tisbury = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_verlucio = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_cunetio = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_durocornovium = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_dorset = {
			title:c_durnovaria = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_velox = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_vindocladia = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_dunum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_somerset = {
			title:c_lindinis = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_peonnum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_avalon = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_tone = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_caer_draitou = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_devon = {
			title:c_isca_dumnonia = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_muridunum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_nemetostatio = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_milidunum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_tamaris = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_hartland = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_pilton = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_cornwall = {
			title:c_din_tagell = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_liskeard = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_bodmin = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_voliba = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_lands_end = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_lyonesse = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		
		## EAST ANGLIA
		title:d_norfolc = {
			title:c_nortwic = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_thetford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_gariannonum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_elmham = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_swaffham = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_southfolc = {
			title:c_rendlesham = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_blything = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_hoxne = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_gippelwich = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_beodericsworth = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_camboritum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_exning = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_grentbryce = {
			title:c_grantabrycge = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_ely = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_huntingdon = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_vicanus = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_godmundceaster = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_gyrwas = {
			title:c_durobrivae = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_peterborough = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_wisbech = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_wisse = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_the_fens = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_stamford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		
		## MERCIA
		title:d_hiccas = {
			title:c_durocobrivis = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_hitchin = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_magiovinium = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_tempsford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_ivel = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_bedford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		title:d_middle_angles = {
			title:c_lactodorum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_bannaventa = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_kettering = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_brinavae = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		
		## NORTHUMBRIA
		title:d_lindsey = {
			title:c_lindum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_segelocum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_ad_abum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_luda = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_banovallum = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_sleaford = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_axholme = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_hatfield = { set_variable = { name = anglo_saxon_duchy value = PREV } }
			title:c_bassetlaw = { set_variable = { name = anglo_saxon_duchy value = PREV } }
		}
		
		# Get a list of provinces that can be under each duchy - we use this to determine which 
		# provinces to recalculate when a de jure shift happens
		every_county = {
			if = {
				limit = { has_variable = anglo_saxon_duchy }
				this.var:anglo_saxon_duchy = { 
					add_to_variable_list = {
						name = de_jure_territory
						target = PREV
					}
				}
			}
			if = {
				limit = { has_variable = secondary_anglo_saxon_duchy }
				this.var:secondary_anglo_saxon_duchy = { 
					add_to_variable_list = {
						name = de_jure_territory
						target = PREV
					}
				}
			}
		}
		
		title:e_aengland = {
			every_in_de_jure_hierarchy = {
				limit = { tier = tier_duchy }
				if = {
					limit = { has_variable_list = de_jure_territory }
					add_to_global_variable_list = {
						name = anglo_saxon_duchy_list
						target = THIS
					}
				}
			}
		}
		
		# Initialize de jure structure
		every_county = {
			check_de_jure_liege_county_effect = yes
		}
	}
}
