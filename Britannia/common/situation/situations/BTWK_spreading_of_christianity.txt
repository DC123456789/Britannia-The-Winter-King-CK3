spreading_of_christianity_situation = {
	
	is_unique = yes # It can only exist once in the world

	gui_window_name = "BTWK_window_spreading_of_christianity_situation"
	gui_participation_window_name = "window_situation_participation"
	map_mode = sub_regions
	illustration = "gfx/interface/illustrations/situations/situation_spreading_of_christianity.dds"
	situation_group_type = major

	icon = {
		trigger = { always = yes }
		reference = "gfx/interface/icons/situations/spreading_of_christianity_situation.dds"
	}
	
	is_unique = yes

	##################################################
	# Regions
	##################################################
	sub_regions = {
		britannia = {
			geographical_regions = { btwk_world_britannia }
		}
	}
	
	##################################################
	# On Actions
	##################################################
	# on_monthly = {		# Recalculate phases for each sub region each month
	# }

	##################################################
	# Groups
	##################################################
	participant_groups = {
		christian_rulers = {
			icon = "gfx/interface/icons/situations/debug_situation/group_nomad.dds"

			is_character_valid = {
				has_religion = religion:christianity_religion
			}

			on_join = { }
			on_leave = { }

			map_color = hsv{ 0.37 1.00 0.78 }
		}

		non_christian_rulers = {
			icon = "gfx/interface/icons/situations/debug_situation/group_other.dds"

			is_character_valid = {
				NOT = { has_religion = religion:christianity_religion }
			}
			
			on_join = { }
			on_leave = { }

			map_color = hsv{ 0.8 0.75 0.83 }
		}
	}
	
	on_start = {
		every_situation_participant = { trigger_event = spreading_of_christianity.0001 }
		every_situation_county = {
			limit = { religion != religion:christianity_religion }
			
			# Counties start with some proselytization progress
			set_variable = { name = soc_proselytization_progress value = soc_proselytization_monthly_progress_value }
			random_list = {
				1 = { change_variable = { name = soc_proselytization_progress multiply = 5 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 6 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 7 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 8 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 9 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 10 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 11 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 12 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 13 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 14 } }
				1 = { change_variable = { name = soc_proselytization_progress multiply = 15 } }
			}
			clamp_variable = { name = soc_proselytization_progress min = 0 max = 100 }
			
			# Calculate months remaining at current rate
			if = {
				limit = { soc_proselytization_monthly_progress_value > 0 }
				set_variable = { 
					name = soc_proselytization_months_remaining
					value = {
						value = 100
						subtract = soc_proselytization_progress
						divide = soc_proselytization_monthly_progress_value
					}
				}
				set_variable = { 
					name = soc_proselytization_years_remaining
					value = {
						value = this.var:soc_proselytization_months_remaining
						divide = 12
					}
				}
			}
			else = {
				set_variable = { 
					name = soc_proselytization_months_remaining
					value = -1
				}
				set_variable = { 
					name = soc_proselytization_years_remaining
					value = -1
				}
			}
			
			# TODO Calculate the faith that this county will convert to
			
			# Add the notification modifier
			save_scope_as = current_county
			remove_county_modifier = BTWK_spreading_of_christianity_proselytization_modifier
			add_county_modifier = {
				modifier = BTWK_spreading_of_christianity_proselytization_modifier
				desc = BTWK_spreading_of_christianity_proselytization_modifier_desc_loc
			}
		}
	}
	
	##################################################
	# Phases
	##################################################
	start_phase = spreading_of_christianity_phase_0

	phases = {
		spreading_of_christianity_phase_0 = {
			icon = "gfx/interface/icons/situations/debug_situation/plentiful_harvest.dds"

			illustration = "gfx/interface/illustrations/event_scenes/fp1_tribal_temple.dds"

			on_start = {
				scope:situation_sub_region = {
					# every_situation_participant = { trigger_event = spreading_of_christianity_situation.0010 }
				}
			}
			on_end = {
			}

			future_phases = {
				spreading_of_christianity_phase_1 = { }
			}

			modifier_sets = {
				spreading_of_christianity_situation_religion_effects = {
					icon = "gfx/interface/icons/struggle_effects/faith.dds"
				}
			}
		}

		spreading_of_christianity_phase_1 = {
			icon = "gfx/interface/icons/situations/debug_situation/plentiful_harvest.dds"

			illustration = "gfx/interface/illustrations/situations/situation_spreading_of_christianity.dds"

			on_start = {
				scope:situation_sub_region = {
					# every_situation_participant = { trigger_event = spreading_of_christianity_situation.0011 }
				}
			}
			on_end = {
			}

			future_phases = {
				spreading_of_christianity_phase_0 = { }
				spreading_of_christianity_phase_2 = { }
			}

			modifier_sets = {
				spreading_of_christianity_situation_religion_effects = {
					icon = "gfx/interface/icons/struggle_effects/faith.dds"
				}
			}
		}

		spreading_of_christianity_phase_2 = {
			icon = "gfx/interface/icons/situations/debug_situation/plentiful_harvest.dds"

			illustration = "gfx/interface/illustrations/situations/situation_spreading_of_christianity.dds"

			on_start = {
				scope:situation_sub_region = {
					# every_situation_participant = { trigger_event = spreading_of_christianity_situation.0012 }
				}
			}
			on_end = {
			}

			future_phases = {
				spreading_of_christianity_phase_1 = { }
				spreading_of_christianity_phase_3 = { }
			}

			modifier_sets = {
				spreading_of_christianity_situation_religion_effects = {
					icon = "gfx/interface/icons/struggle_effects/faith.dds"
				}
			}
		}

		spreading_of_christianity_phase_3 = {
			icon = "gfx/interface/icons/situations/debug_situation/plentiful_harvest.dds"

			illustration = "gfx/interface/illustrations/event_scenes/ep2_holysite_western.dds"

			on_start = {
				scope:situation_sub_region = {
					# every_situation_participant = { trigger_event = spreading_of_christianity_situation.0013 }
				}
			}
			on_end = {
			}

			future_phases = {
				spreading_of_christianity_phase_2 = { }
				spreading_of_christianity_phase_4 = { }
			}

			modifier_sets = {
				spreading_of_christianity_situation_religion_effects = {
					icon = "gfx/interface/icons/struggle_effects/faith.dds"
				}
			}
		}

		spreading_of_christianity_phase_4 = {
			icon = "gfx/interface/icons/situations/debug_situation/plentiful_harvest.dds"

			illustration = "gfx/interface/illustrations/event_scenes/ep2_holysite_western.dds"

			on_start = {
				scope:situation_sub_region = {
					# every_situation_participant = { trigger_event = spreading_of_christianity_situation.0014 }
				}
			}
			on_end = {
			}

			future_phases = {
				spreading_of_christianity_phase_3 = { }
			}

			modifier_sets = {
				spreading_of_christianity_situation_religion_effects = {
					icon = "gfx/interface/icons/struggle_effects/faith.dds"
				}
			}
		}
	}
}
