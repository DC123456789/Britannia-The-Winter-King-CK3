soc_phase_1_threshold = 0.05
soc_phase_2_threshold = 0.25
soc_phase_3_threshold = 0.50
soc_phase_4_threshold = 0.75

soc_phase_0_base_spread = -0.5
soc_phase_1_base_spread = -0.25
soc_phase_2_base_spread = 0
soc_phase_3_base_spread = 0.125
soc_phase_4_base_spread = 0.25

soc_internal_missionaries_holder_base_spread = 0.50
soc_internal_missionaries_realm_base_spread = 0.25
soc_external_missionaries_base_spread = 0.20
soc_encourage_missionaries_holder_base_spread = 0.40
soc_encourage_missionaries_realm_base_spread = 0.20
soc_ban_missionaries_holder_base_spread = -0.40
soc_ban_missionaries_realm_base_spread = -0.20

# Should not be used outside the BTWK_soc_situation_set_proselytization_modifier_effect scripted effect
# as that effect sets up many of the variables and lists this uses
soc_proselytization_monthly_progress_value = {
	value = 0
	# Phase modifiers
	if = {
		limit = { 
			any_county_situation_sub_region = { 
				sub_region_current_phase = spreading_of_christianity_phase_0
			}
		}
		add = {
			value = soc_phase_0_base_spread
			desc = PROSELYTIZATION_PROGRESS_PHASE_0
		}
	}
	else_if = {
		limit = { 
			any_county_situation_sub_region = { 
				sub_region_current_phase = spreading_of_christianity_phase_1
			}
		}
		add = {
			value = soc_phase_1_base_spread
			desc = PROSELYTIZATION_PROGRESS_PHASE_1
		}
	}
	else_if = {
		limit = { 
			any_county_situation_sub_region = { 
				sub_region_current_phase = spreading_of_christianity_phase_2
			}
		}
		add = {
			value = soc_phase_2_base_spread
			desc = PROSELYTIZATION_PROGRESS_PHASE_2
		}
	}
	else_if = {
		limit = { 
			any_county_situation_sub_region = { 
				sub_region_current_phase = spreading_of_christianity_phase_3
			}
		}
		add = {
			value = soc_phase_3_base_spread
			desc = PROSELYTIZATION_PROGRESS_PHASE_3
		}
	}
	else_if = {
		limit = { 
			any_county_situation_sub_region = { 
				sub_region_current_phase = spreading_of_christianity_phase_4
			}
		}
		add = {
			value = soc_phase_4_base_spread
			desc = PROSELYTIZATION_PROGRESS_PHASE_4
		}
	}
	# Religion/Faith modifiers
	if = {
		limit = { 
			holder.religion = religion:christianity_religion
		}
		add = {
			value = 0.25
			desc = PROSELYTIZATION_PROGRESS_HOLDER_CHRISTIAN
		}
	}
	if = {
		limit = { 
			holder.top_liege.religion = religion:christianity_religion
		}
		add = {
			value = 0.15
			desc = PROSELYTIZATION_PROGRESS_TOP_LIEGE_CHRISTIAN
		}
	}
	if = {
		limit = { 
			any_neighboring_county = { religion = religion:christianity_religion }
		}
		add = {
			value = 0.25
			desc = PROSELYTIZATION_PROGRESS_NEIGBOURING_CHRISTIAN_COUNTY
		}
	}
	if = {
		limit = { 
			faith = { NOT = { has_doctrine_parameter = unreformed } }
		}
		subtract = {
			value = 0.5
			desc = PROSELYTIZATION_PROGRESS_IS_ORGANIZED_FAITH
		}
	}
	if = {
		limit = { 
			faith = { NOT = { has_doctrine_parameter = unreformed } }
			religion = holder.religion
		}
		subtract = {
			value = 0.25
			desc = PROSELYTIZATION_PROGRESS_IS_ORGANIZED_FAITH_UNDER_SAME_RELIGION_HOLDER
		}
	}
	if = {
		limit = { 
			faith = { NOT = { has_doctrine_parameter = unreformed } }
			religion = holder.top_liege.religion
		}
		subtract = {
			value = 0.25
			desc = PROSELYTIZATION_PROGRESS_IS_ORGANIZED_FAITH_UNDER_SAME_RELIGION_TOP_LIEGE
		}
	}
	if = {
		limit = { 
			NOT = { holder.religion = religion:christianity_religion }
			holder = { has_trait = zealous }
		}
		subtract = {
			value = 0.15		# Relatively small because they should be using the Ban Missionaries interaction
			desc = PROSELYTIZATION_PROGRESS_HOLDER_ZEALOUS_NON_CHRISTIAN
		}
	}
	# Fervor modifiers
	subtract = {
		value = {
			value = 0.4
			multiply = {
				value = faith.fervor
				divide = 100
			}
		}
		desc = PROSELYTIZATION_PROGRESS_COUNTY_FAITH_FERVOR
	}
	add = {
		value = {
			value = 0.4
			multiply = {
				value = var:soc_proselytization_target_faith.fervor
				divide = 100
			}
		}
		desc = PROSELYTIZATION_PROGRESS_CONVERTING_FAITH_FERVOR
	}
	# Heritage modifiers
	if = {
		limit = {
			culture = {
				OR = {
					has_cultural_pillar = heritage_latin
					has_cultural_pillar = heritage_romance
					has_cultural_pillar = heritage_romanized_germanic
					has_cultural_pillar = heritage_romanized_sarmatian
				}
			}
		}
		add = {
			value = 0.10
			desc = PROSELYTIZATION_PROGRESS_COUNTY_HERITAGE
		}
	}
	else_if = {
		limit = { 
			culture = {
				OR = {
					has_cultural_pillar = heritage_brythonic
					has_cultural_pillar = heritage_goidelic
				}
			}
		}
		add = {
			value = 0.05
			desc = PROSELYTIZATION_PROGRESS_COUNTY_HERITAGE
		}
	}
	else_if = {
		limit = { 
			culture = {
				OR = {
					AND = {
						has_cultural_pillar = heritage_west_germanic
						NOT = { has_global_variable = first_saxon_catholic_king }
					}
					has_cultural_pillar = heritage_central_germanic
				}
			}
		}
		subtract = {
			value = 0.05
			desc = PROSELYTIZATION_PROGRESS_COUNTY_HERITAGE
		}
	}
	else_if = {
		limit = { 
			culture = {
				OR = {
					has_cultural_pillar = heritage_north_germanic
				}
			}
		}
		subtract = {
			value = 0.10
			desc = PROSELYTIZATION_PROGRESS_COUNTY_HERITAGE
		}
	}
	# Terrain modifiers
	if = {
		limit = {
			OR = {
				title_province = { terrain = farmlands }
				title_province = { terrain = plains }
			}
		}
		add = {
			value = 0
			desc = PROSELYTIZATION_PROGRESS_TERRAIN
		}
	}
	else_if = {
		limit = {
			title_province = { terrain = hills }
		}
		subtract = {
			value = 0.1
			desc = PROSELYTIZATION_PROGRESS_TERRAIN
		}
	}
	else_if = {
		limit = {
			OR = {
				title_province = { terrain = desert }
				title_province = { terrain = oasis }
			}
		}
		subtract = {
			value = 0.15
			desc = PROSELYTIZATION_PROGRESS_TERRAIN
		}
	}
	else_if = {
		limit = {
			title_province = { terrain = forest }
		}
		subtract = {
			value = 0.25
			desc = PROSELYTIZATION_PROGRESS_TERRAIN
		}
	}
	else_if = {
		limit = {
			OR = {
				title_province = { terrain = jungle }
				title_province = { terrain = taiga }
				title_province = { terrain = wetlands }
			}
		}
		subtract = {
			value = 0.35
			desc = PROSELYTIZATION_PROGRESS_TERRAIN
		}
	}
	else_if = {
		limit = {
			OR = {
				title_province = { terrain = mountains }
				title_province = { terrain = desert_mountains }
			}
		}
		subtract = {
			value = 0.5
			desc = PROSELYTIZATION_PROGRESS_TERRAIN
		}
	}
	if = {
		limit = {
			holder = {
				religion = religion:christianity_religion
				has_character_modifier = BTWK_soc_sponsoring_internal_missionaries_modifier
			}
		}
		add = {
			value = soc_internal_missionaries_holder_base_spread
			desc = PROSELYTIZATION_HOLDER_INTERNAL_MISSIONARIES
		}
	}
	add = {
		value = {
			value = 0
			save_temporary_value_as = current_harmonic_sum
			value = 1
			save_temporary_value_as = current_index
			holder = {
				every_liege_or_above = {
					limit = {
						religion = religion:christianity_religion
						has_character_modifier = BTWK_soc_sponsoring_internal_missionaries_modifier
					}
					value = 0
					add = 1
					divide = scope:current_index
					add = scope:current_harmonic_sum
					save_temporary_value_as = current_harmonic_sum
					value = scope:current_index
					add = 1
					save_temporary_value_as = current_index
				}
			}
			value = scope:current_harmonic_sum
		}
		multiply = soc_internal_missionaries_realm_base_spread
		desc = PROSELYTIZATION_LIEGE_INTERNAL_MISSIONARIES
	}
	add = {
		value = {
			value = 0
			save_temporary_value_as = current_harmonic_sum
			value = 1
			save_temporary_value_as = current_index
			every_in_list = {
				variable = nearby_external_missionary_sponsors
				value = 0
				add = 1
				divide = scope:current_index
				add = scope:current_harmonic_sum
				save_temporary_value_as = current_harmonic_sum
				value = scope:current_index
				add = 1
				save_temporary_value_as = current_index
			}
			value = scope:current_harmonic_sum
		}
		multiply = soc_external_missionaries_base_spread
		desc = PROSELYTIZATION_EXTERNAL_MISSIONARIES
	}
	if = {
		limit = {
			holder = {
				religion != religion:christianity_religion
				has_character_modifier = BTWK_soc_encouraging_missionaries_modifier
			}
		}
		add = {
			value = soc_encourage_missionaries_holder_base_spread
			desc = PROSELYTIZATION_HOLDER_ENCOURAGING_MISSIONARIES
		}
	}
	add = {
		value = {
			value = 0
			save_temporary_value_as = current_harmonic_sum
			value = 1
			save_temporary_value_as = current_index
			holder = {
				every_liege_or_above = {
					limit = {
						religion != religion:christianity_religion
						has_character_modifier = BTWK_soc_encouraging_missionaries_modifier
					}
					value = 0
					add = 1
					divide = scope:current_index
					add = scope:current_harmonic_sum
					save_temporary_value_as = current_harmonic_sum
					value = scope:current_index
					add = 1
					save_temporary_value_as = current_index
				}
			}
			value = scope:current_harmonic_sum
		}
		multiply = soc_encourage_missionaries_realm_base_spread
		desc = PROSELYTIZATION_LIEGE_ENCOURAGING_MISSIONARIES
	}
	if = {
		limit = {
			holder = {
				religion != religion:christianity_religion
				has_character_modifier = BTWK_soc_banning_missionaries_modifier
			}
		}
		add = {
			value = soc_ban_missionaries_holder_base_spread
			desc = PROSELYTIZATION_HOLDER_BANNING_MISSIONARIES
		}
	}
	add = {
		value = {
			value = 0
			save_temporary_value_as = current_harmonic_sum
			value = 1
			save_temporary_value_as = current_index
			holder = {
				every_liege_or_above = {
					limit = {
						religion != religion:christianity_religion
						has_character_modifier = BTWK_soc_banning_missionaries_modifier
					}
					value = 0
					add = 1
					divide = scope:current_index
					add = scope:current_harmonic_sum
					save_temporary_value_as = current_harmonic_sum
					value = scope:current_index
					add = 1
					save_temporary_value_as = current_index
				}
			}
			value = scope:current_harmonic_sum
		}
		multiply = soc_ban_missionaries_realm_base_spread
		desc = PROSELYTIZATION_LIEGE_BANNING_MISSIONARIES
	}
}

soc_proselytization_num_liege_internal_missionaries = {
	value = 0
	holder = {
		every_liege_or_above = {
			limit = {
				religion = religion:christianity_religion
				has_character_modifier = BTWK_soc_sponsoring_internal_missionaries_modifier
			}
			add = 1			
		}
	}
}

soc_proselytization_num_external_missionaries = {
	value = 0
	every_in_list = {
		variable = nearby_external_missionary_sponsors
		add = 1
	}
}

soc_proselytization_num_liege_encouraging_missionaries = {
	value = 0
	holder = {
		every_liege_or_above = {
			limit = {
				religion != religion:christianity_religion
				has_character_modifier = BTWK_soc_encouraging_missionaries_modifier
			}
			add = 1			
		}
	}
}

soc_proselytization_num_liege_banning_missionaries = {
	value = 0
	holder = {
		every_liege_or_above = {
			limit = {
				religion != religion:christianity_religion
				has_character_modifier = BTWK_soc_banning_missionaries_modifier
			}
			add = 1			
		}
	}
}

BTWK_soc_internal_missionaries_score = {
	value = -25
	add = ai_zeal
	if = {
		limit = { ai_greed > 0 }
		subtract = {
			value = ai_greed
			multiply = 0.5
		}
	}
	add = {
		value = monthly_character_balance
		divide = monthly_character_income
		subtract = 0.3
		multiply = 25
		divide = 0.15
		max = 25
	}
	add = {
		value = 0
		every_sub_realm_county = {
			limit = {
				faith != prev.faith
				faith = { has_doctrine_parameter = unreformed }
			}
			add = 1
		}
		divide = sub_realm_size
		multiply = 50
	}
}

BTWK_soc_external_missionaries_score = {
	value = -50
	add = ai_zeal
	if = {
		limit = { ai_greed > 0 }
		subtract = {
			value = ai_greed
			multiply = 0.5
		}
	}
	add = {
		value = monthly_character_balance
		divide = monthly_character_income
		subtract = 0.3
		multiply = 30
		divide = 0.15
		max = 25
	}
	add = {
		value = 0
		every_in_list = {
			variable = external_missionary_range_counties
			limit = {
				faith != prev.faith
				faith = { has_doctrine_parameter = unreformed }
			}
			add = 1
		}
		# divide = "variable_list_size(external_missionary_range_counties)"		# Broken
		divide = {
			every_in_list = {
				variable = external_missionary_range_counties
				add = 1
			}
		}
		multiply = 50
	}
}

BTWK_soc_encourage_missionaries_score = {
	value = -25
	subtract = ai_zeal
	add = {
		value = ai_rationality
		multiply = 0.5
	}
	subtract = {
		value = monthly_character_balance
		divide = monthly_character_income
		multiply = 200
		max = 50
		min = -25
	}
}

BTWK_soc_ban_missionaries_score = {
	value = -25
	add = ai_zeal
	subtract = {
		value = ai_rationality
		multiply = 0.5
	}
	add = {
		value = monthly_character_balance
		divide = monthly_character_income
		subtract = 0.1
		multiply = 100
		max = 50
		min = -25
	}
}